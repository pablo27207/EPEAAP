services:
  # ============================================
  # EPEA WEB - Sitio Estático
  # ============================================
  epea-web:
    build: .
    container_name: epea-web
    restart: unless-stopped
    expose:
      - "80"
    networks:
      - web-public
    labels:
      - "traefik.enable=true"
      # Router HTTP
      # Regla: Host específico y ruta que empieza con /EPEA
      - "traefik.http.routers.epea.rule=Host(`${DOMAIN:-gipis.unp.edu.ar}`) && PathPrefix(`/EPEA`)"
      - "traefik.http.routers.epea.entrypoints=web"

      # Middleware: Eliminar el prefijo /EPEA antes de que llegue a Nginx
      # Esto hace que Nginx vea "/" cuando el usuario pide "/EPEA/"
      - "traefik.http.middlewares.epea-strip.stripprefix.prefixes=/EPEA"
      - "traefik.http.routers.epea.middlewares=epea-strip"

      # Servicio interno
      - "traefik.http.services.epea.loadbalancer.server.port=80"

networks:
  # Conectamos a la red existente donde corre Traefik
  web-public:
    external: true
    name: web-public
